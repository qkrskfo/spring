<!DOCTYPE html>
<html>
<head>
<title>WELCOME TO AJAX</title>
<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="style.css" />
<link rel="stylesheet" href="guest.css" type="text/css" media="screen" />
<style type="text/css">
input.error, textarea.error {
	border: 1px solid orange;
}

label.error {
	margin-left: 10px;
	color: orange;
}
</style>
<script src="./js/httpRequest.js" type="text/javascript"></script>

<!--
<script src="guest.js" type="text/javascript"></script>
-->
<script type="text/javascript">
	/**%%% 응답 도착했을 때 실행되는 콜백 함수 %%%**/
	/****guest_list[HTML] 콜백 함수****/
	function displayGuestListHTML() {
		if(xhr.readyState==4) {
			if(xhr.status==200) {
				//console.log(xhr.responseText);
				
				/*
				<div class="guest_item">
					<h3 class="guest_title"  guest_no="126">
						<a href=''>타이틀[HTML]</a>
					</h3>
				</div>
				 */
				 
				document.querySelector('#guest_list').innerHTML=xhr.responseText;
				showLoadingDialog(false);
			}else {
				alert('error발생!!!');
			}
		} 
	}
	
	/****guest_list[JSON] 콜백 함수****/
	function displayGuestListJSON() {
		if(xhr.readyState==4 && xhr.status==200) {
			var guestListJsonArray = JSON.parse(xhr.responseText);
			
			/*
			<< JSON >>
			[
				{
				"guest_no": "1",
				"guest_title": "방명록 사용법1",
				},{},{}
			]
			*/
			/*
			<< HTML >>
			<div class="guest_item">
					<h3 class="guest_title"  guest_no="126">
						<a href=''>타이틀[HTML]</a>
					</h3>
			</div>
			<div class="guest_item">..</div>
			...
			 */
			
			var html="";
			for(var i=0; i<guestListJsonArray.length; i++) {
				//console.log(guestListJsonArray[i]);
				html+=`
					<div class="guest_item">
						<h3 class="guest_title" guest_no="${guestListJsonArray[i].guest_no}">
							<a href="">${guestListJsonArray[i].guest_title}[JSON]</a>
						</h3>
					</div>`;
			}
			document.querySelector("#guest_list").innerHTML=html;
			showLoadingDialog(false);
		}
	}
	
	/****guest_list[XML] 콜백 함수****/
	function displayGuestListXML(){
		if(xhr.readyState==4 && xhr.status==200) {
			var xmlDocument = xhr.responseXML;
			/*
			<< XML >>
			<guest_list>
				<guest>
					<guest_no>1</guest_no>
					<guest_title>방명록 사용법1</guest_title>
				</guest>
				<guest>..</guest>
				<guest>..</guest>
				...
			</guest_list>
			*/
			var guestNodeList = xmlDocument.getElementsByTagName('guest');
			var html="";
			for (let i=0; i<guestNodeList.length; i++) {
				//let 변수는 scope가 이 scope로 한정됨.
				var guest_noStr = guestNodeList[i].getElementsByTagName("guest_no")[0].firstChild.nodeValue;
				var guest_titleStr = guestNodeList[i].getElementsByTagName("guest_title")[0].firstChild.nodeValue;
				html+=`
					<div class="guest_item">
						<h3 class="guest_title" guest_no="${guest_noStr}">
							<a href="">${guest_titleStr}[XML]</a>
						</h3>
					</div>
				`;
			}
			document.querySelector('#guest_list').innerHTML=html;
			showLoadingDialog(false);
			/*
			<< HTML >>
			<div class="guest_item">
					<h3 class="guest_title"  guest_no="126">
						<a href="">타이틀[XML]</a>
					</h3>
			</div>
			<div class="guest_item">..</div>
			<div class="guest_item">..</div>
			 */
		}
	}
	

	/**%%% 메뉴 UI이벤트 처리시작 %%%**/
	window.onload=function() {
		/** guest_list[HTML]메뉴 이벤트 **/
		document.querySelector('#menu-a a').addEventListener('click', function(e){
			//alert('guest_list [html]');
			
			//ajax요청
			sendRequest('guest/guest_list_html.jsp',null,displayGuestListHTML ,'GET');
			showLoadingDialog(true);
			e.preventDefault();
		});
		
		/** guest_list[JSON]메뉴 이벤트 **/
		document.querySelector('#menu-b a').addEventListener('click', function(e){
			//ajax요청
			sendRequest('guest/guest_list_json.jsp', null, displayGuestListJSON, 'GET');
			showLoadingDialog(true);
			e.preventDefault();
		});
		
		/** guest_list[XML]메뉴 이벤트 **/
		document.querySelector('#menu-c a').addEventListener('click', function(e){
			//ajax요청
			sendRequest('guest/guest_list_xml.jsp', null, displayGuestListXML, 'GET');
			showLoadingDialog(true);
			e.preventDefault();
		});
		
	};
	/**%%% 메뉴 UI이벤트 처리 끝 %%%**/
	
	/****** loading dialog 생성삭제 함수 시작 *******/
	function showLoadingDialog(isVisible){
		if(isVisible){
			var dialogDivE = document.createElement('div');
			dialogDivE.setAttribute('id','loading');
			dialogDivE.innerHTML='loading...';
			dialogDivE.style.display='block';
			var guestListDivE = document.querySelector('#guest_list');
			document.querySelector('#content').insertBefore(dialogDivE , guestListDivE);
		}else{
			var loadingDivE = document.querySelector('#loading');
			document.querySelector('#content').removeChild(loadingDivE);
		}	
	}
	/****** loading dialog 생성삭제 함수 끝 *******/
	
</script>
</head>
<body>
	<div id="container">
		<div id="header">
			<h1>WELCOME TO AJAX</h1>
		</div>
		<div id="sidebar">

			<h2>회원관리메뉴</h2>
			<div class="menus">
				<div class="menu" id="menu-a">
					<h3>
						<a href="test.jsp">방명록 리스트[html]</a>
					</h3>
				</div>
				<div class="menu" id="menu-b">
					<h3>
						<a href="#">방명록 리스트[json]</a>
					</h3>
				</div>
				<div class="menu" id="menu-c">
					<h3>
						<a href="#">방명록 리스트[xml]</a>
					</h3>
				</div>
				<div class="menu" id="menu-d">
					<h3>
						<a href="#">방명록 쓰기</a>
					</h3>
				</div>
				<!-- 
				<form id="guest_login_form" method="get" action="vfbfcv">
					<fieldset>
						<legend>로그인</legend>
						<p>
							<label for="guest_id">아이디:</label> <input type="text"
								id="guest_id" name="guest_id" />
						</p>
						<p>
							<label for="guest_pass">패쓰워드:</label> <input type="text"
								name="guest_pass" id="guest_pass" />
						</p>
						<p>
							<input type="submit" name="write" value="로그인" id="write" /> <input
								type="reset" name="cancle" value="취소" id="cancle" />

						</p>
						<div id="msg"></div>
					</fieldset>
				</form>
				<form id="guest_logout_form">
					<div>
						<span id="idSpan"></span>님 로그인<br /> <a id="guest_logout_a"
							href='#'>로그아웃</a>
					</div>
				</form>
				-->
			</div>
		</div>
		<div id="content">
			<!--  
			<div id='loading'>loading..</div>
			-->
			<div id="guest_list">

				<!-- 
              
                 -->
			</div>
		</div>
		<div id="footer">
			<p>This page was built for javascript ajax demonstration purposes.</p>
		</div>

	</div>

</body>
</html>
